#! /bin/bash
curl -H 'Accept: application/json' -H 'Content-Type: application/json' -X POST --data '{
  "name":"'$1'"
}' http://admin:admin@{{grafana_host}}:{{grafana_port}}/api/orgs

orgid=$(curl -H 'Accept: application/json' -H 'Content-Type: application/json' -X GET http://admin:admin@{{grafana_host}}:{{grafana_port}}/api/orgs/name/$1 |xargs -d ',' -n 1 echo |awk -F":" '/id/ {print $2}')

curl -H 'Accept: application/json' -H 'Content-Type: application/json' -X POST http://admin:admin@{{grafana_host}}:{{grafana_port}}/api/user/using/$orgid

curl -H 'Accept: application/json' -H 'Content-Type: application/json' -X POST --data '{
    "name": "mylogstash-yarn-running",
    "type": "elasticsearch",
    "typeLogoUrl": "",
    "access": "proxy",
    "url": "http://localhost:{{elastic_port}}",
    "password": "",
    "user": "",
    "database": "mylogstash-yarn-running",
    "basicAuth": false,
    "basicAuthUser": "",
    "basicAuthPassword": "",
    "withCredentials": false,
    "isDefault": false,
    "jsonData": {
        "esVersion": 2,
        "timeField": "logdate"
    },
    "secureJsonFields": {}
}' http://admin:admin@{{grafana_host}}:{{grafana_port}}/api/datasources

curl -H 'Accept: application/json' -H 'Content-Type: application/json' -X POST --data '{
    "name": "mylogstash-yarn-apps",
    "type": "elasticsearch",
    "typeLogoUrl": "",
    "access": "proxy",
    "url": "http://localhost:{{elastic_port}}",
    "password": "",
    "user": "",
    "database": "mylogstash-yarn-apps",
    "basicAuth": false,
    "basicAuthUser": "",
    "basicAuthPassword": "",
    "withCredentials": false,
    "isDefault": false,
    "jsonData": {
        "esVersion": 2,
        "timeField": "finishedTime"
    },
    "secureJsonFields": {}
}' http://admin:admin@{{grafana_host}}:{{grafana_port}}/api/datasources

curl -H 'Accept: application/json' -H 'Content-Type: application/json' -X POST --data '{
    "dashboard": {
        "annotations": {
            "list": []
        },
        "description": "",
        "editable": true,
        "gnetId": null,
        "graphTooltip": 0,
        "hideControls": false,
        "id": null,
        "links": [
            {
                "asDropdown": true,
                "icon": "external link",
                "tags": [],
                "title": "切换报表",
                "type": "dashboards"
            }
        ],
        "refresh": "1m",
        "rows": [
            {
                "collapse": false,
                "height": 250,
                "panels": [
                    {
                        "aliasColors": {
                            "FREE": "#7EB26D",
                            "MAPREDUCE": "#1F78C1",
                            "SPARK": "#E5AC0E",
                            "mapreduce": "#1F78C1",
                            "others": "#3F6833",
                            "spark": "#E0752D",
                            "tez": "#BF1B00"
                        },
                        "bars": false,
                        "dashLength": 10,
                        "dashes": false,
                        "datasource": "mylogstash-yarn-running",
                        "fill": 1,
                        "hideTimeOverride": false,
                        "id": 1,
                        "interval": ">60s",
                        "legend": {
                            "alignAsTable": false,
                            "avg": false,
                            "current": false,
                            "hideEmpty": false,
                            "hideZero": false,
                            "max": false,
                            "min": false,
                            "rightSide": false,
                            "show": true,
                            "total": false,
                            "values": false
                        },
                        "lines": true,
                        "linewidth": 1,
                        "links": [],
                        "nullPointMode": "null",
                        "percentage": false,
                        "pointradius": 1,
                        "points": false,
                        "renderer": "flot",
                        "seriesOverrides": [],
                        "spaceLength": 10,
                        "span": 6,
                        "stack": true,
                        "steppedLine": false,
                        "targets": [
                            {
                                "alias": "",
                                "bucketAggs": [
                                    {
                                        "fake": true,
                                        "id": "4",
                                        "query": "*",
                                        "settings": {
                                            "filters": [
                                                {
                                                    "query": "mapreduce"
                                                },
                                                {
                                                    "query": "spark"
                                                },
                                                {
                                                    "query": "tez"
                                                },
                                                {
                                                    "query": "others"
                                                }
                                            ]
                                        },
                                        "type": "filters"
                                    },
                                    {
                                        "field": "logdate",
                                        "id": "2",
                                        "settings": {
                                            "interval": "auto",
                                            "min_doc_count": 0,
                                            "trimEdges": 0
                                        },
                                        "type": "date_histogram"
                                    }
                                ],
                                "dsType": "elasticsearch",
                                "hide": false,
                                "metrics": [
                                    {
                                        "field": "vCores",
                                        "id": "3",
                                        "inlineScript": null,
                                        "meta": {},
                                        "settings": {},
                                        "type": "sum"
                                    }
                                ],
                                "query": "queue: $queue",
                                "refId": "A",
                                "timeField": "logdate"
                            }
                        ],
                        "thresholds": [],
                        "timeFrom": null,
                        "timeShift": null,
                        "title": "不同作业类型的CPU利用率情况",
                        "tooltip": {
                            "shared": true,
                            "sort": 2,
                            "value_type": "individual"
                        },
                        "transparent": false,
                        "type": "graph",
                        "xaxis": {
                            "buckets": null,
                            "mode": "time",
                            "name": null,
                            "show": true,
                            "values": []
                        },
                        "yaxes": [
                            {
                                "format": "short",
                                "label": "",
                                "logBase": 1,
                                "max": null,
                                "min": null,
                                "show": true
                            },
                            {
                                "format": "short",
                                "label": null,
                                "logBase": 1,
                                "max": null,
                                "min": null,
                                "show": true
                            }
                        ]
                    },
                    {
                        "aliasColors": {
                            "mapreduce": "#1F78C1",
                            "others": "#3F6833",
                            "spark": "#E0752D",
                            "tez": "#890F02"
                        },
                        "bars": false,
                        "dashLength": 10,
                        "dashes": false,
                        "datasource": "mylogstash-yarn-running",
                        "fill": 1,
                        "id": 9,
                        "interval": ">60s",
                        "legend": {
                            "avg": false,
                            "current": false,
                            "max": false,
                            "min": false,
                            "show": true,
                            "total": false,
                            "values": false
                        },
                        "lines": true,
                        "linewidth": 1,
                        "links": [],
                        "nullPointMode": "null",
                        "percentage": false,
                        "pointradius": 5,
                        "points": false,
                        "renderer": "flot",
                        "seriesOverrides": [],
                        "spaceLength": 10,
                        "span": 6,
                        "stack": true,
                        "steppedLine": false,
                        "targets": [
                            {
                                "bucketAggs": [
                                    {
                                        "fake": true,
                                        "id": "3",
                                        "query": "*",
                                        "settings": {
                                            "filters": [
                                                {
                                                    "query": "mapreduce"
                                                },
                                                {
                                                    "query": "spark"
                                                },
                                                {
                                                    "query": "tez"
                                                },
                                                {
                                                    "query": "others"
                                                }
                                            ]
                                        },
                                        "type": "filters"
                                    },
                                    {
                                        "field": "logdate",
                                        "id": "2",
                                        "settings": {
                                            "interval": "auto",
                                            "min_doc_count": 0,
                                            "trimEdges": 0
                                        },
                                        "type": "date_histogram"
                                    }
                                ],
                                "dsType": "elasticsearch",
                                "metrics": [
                                    {
                                        "field": "memory",
                                        "id": "1",
                                        "meta": {},
                                        "settings": {},
                                        "type": "sum"
                                    }
                                ],
                                "query": "queue: $queue",
                                "refId": "A",
                                "timeField": "logdate"
                            }
                        ],
                        "thresholds": [],
                        "timeFrom": null,
                        "timeShift": null,
                        "title": "不同作业类型的内存利用率情况",
                        "tooltip": {
                            "shared": true,
                            "sort": 0,
                            "value_type": "individual"
                        },
                        "type": "graph",
                        "xaxis": {
                            "buckets": null,
                            "mode": "time",
                            "name": null,
                            "show": true,
                            "values": []
                        },
                        "yaxes": [
                            {
                                "format": "short",
                                "label": null,
                                "logBase": 1,
                                "max": null,
                                "min": null,
                                "show": true
                            },
                            {
                                "format": "short",
                                "label": null,
                                "logBase": 1,
                                "max": null,
                                "min": null,
                                "show": true
                            }
                        ]
                    }
                ],
                "repeat": null,
                "repeatIteration": null,
                "repeatRowId": null,
                "showTitle": true,
                "title": "'$1' CPU和内存利用率情况",
                "titleSize": "h6"
            },
            {
                "collapse": false,
                "height": 284,
                "panels": [
                    {
                        "aliasColors": {},
                        "bars": true,
                        "dashLength": 10,
                        "dashes": false,
                        "datasource": "mylogstash-yarn-apps",
                        "fill": 1,
                        "id": 2,
                        "interval": ">60s",
                        "legend": {
                            "avg": false,
                            "current": false,
                            "max": false,
                            "min": false,
                            "rightSide": false,
                            "show": true,
                            "total": false,
                            "values": false
                        },
                        "lines": false,
                        "linewidth": 1,
                        "links": [],
                        "nullPointMode": "null",
                        "percentage": false,
                        "pointradius": 5,
                        "points": false,
                        "renderer": "flot",
                        "seriesOverrides": [],
                        "spaceLength": 10,
                        "span": 4,
                        "stack": false,
                        "steppedLine": false,
                        "targets": [
                            {
                                "bucketAggs": [
                                    {
                                        "fake": true,
                                        "field": "appId",
                                        "id": "3",
                                        "settings": {
                                            "min_doc_count": 1,
                                            "order": "desc",
                                            "orderBy": "1",
                                            "size": "10"
                                        },
                                        "type": "terms"
                                    },
                                    {
                                        "field": "finishedTime",
                                        "id": "2",
                                        "settings": {
                                            "interval": "auto",
                                            "min_doc_count": 0,
                                            "trimEdges": 0
                                        },
                                        "type": "date_histogram"
                                    }
                                ],
                                "dsType": "elasticsearch",
                                "metrics": [
                                    {
                                        "field": "vcoreSeconds",
                                        "id": "1",
                                        "meta": {},
                                        "settings": {},
                                        "type": "max"
                                    }
                                ],
                                "query": "appState: FINISHED AND appType: MAPREDUCE AND queue: $queue",
                                "refId": "A",
                                "timeField": "finishedTime"
                            }
                        ],
                        "thresholds": [],
                        "timeFrom": null,
                        "timeShift": null,
                        "title": "Top-10已完成Mapreduce作业的CPU消耗情况 ",
                        "tooltip": {
                            "shared": false,
                            "sort": 0,
                            "value_type": "individual"
                        },
                        "type": "graph",
                        "xaxis": {
                            "buckets": null,
                            "mode": "series",
                            "name": null,
                            "show": false,
                            "values": [
                                "max"
                            ]
                        },
                        "yaxes": [
                            {
                                "format": "short",
                                "label": null,
                                "logBase": 1,
                                "max": null,
                                "min": null,
                                "show": true
                            },
                            {
                                "format": "short",
                                "label": null,
                                "logBase": 1,
                                "max": null,
                                "min": null,
                                "show": true
                            }
                        ]
                    },
                    {
                        "aliasColors": {},
                        "bars": true,
                        "dashLength": 10,
                        "dashes": false,
                        "datasource": "mylogstash-yarn-apps",
                        "fill": 1,
                        "id": 5,
                        "interval": ">60s",
                        "legend": {
                            "avg": false,
                            "current": false,
                            "max": false,
                            "min": false,
                            "show": true,
                            "total": false,
                            "values": false
                        },
                        "lines": false,
                        "linewidth": 1,
                        "links": [],
                        "nullPointMode": "null",
                        "percentage": false,
                        "pointradius": 5,
                        "points": false,
                        "renderer": "flot",
                        "seriesOverrides": [],
                        "spaceLength": 10,
                        "span": 4,
                        "stack": false,
                        "steppedLine": false,
                        "targets": [
                            {
                                "bucketAggs": [
                                    {
                                        "fake": true,
                                        "field": "appId",
                                        "id": "3",
                                        "settings": {
                                            "min_doc_count": 1,
                                            "order": "desc",
                                            "orderBy": "1",
                                            "size": "10"
                                        },
                                        "type": "terms"
                                    },
                                    {
                                        "field": "finishedTime",
                                        "id": "2",
                                        "settings": {
                                            "interval": "auto",
                                            "min_doc_count": 0,
                                            "trimEdges": 0
                                        },
                                        "type": "date_histogram"
                                    }
                                ],
                                "dsType": "elasticsearch",
                                "metrics": [
                                    {
                                        "field": "memorySeconds",
                                        "id": "1",
                                        "meta": {},
                                        "settings": {},
                                        "type": "max"
                                    }
                                ],
                                "query": "appState: FINISHED AND appType: MAPREDUCE AND queue: $queue",
                                "refId": "A",
                                "timeField": "finishedTime"
                            }
                        ],
                        "thresholds": [],
                        "timeFrom": null,
                        "timeShift": null,
                        "title": "Top-10已完成Mapreduce作业的内存消耗情况",
                        "tooltip": {
                            "shared": false,
                            "sort": 0,
                            "value_type": "individual"
                        },
                        "type": "graph",
                        "xaxis": {
                            "buckets": null,
                            "mode": "series",
                            "name": null,
                            "show": false,
                            "values": [
                                "max"
                            ]
                        },
                        "yaxes": [
                            {
                                "format": "short",
                                "label": null,
                                "logBase": 1,
                                "max": null,
                                "min": null,
                                "show": true
                            },
                            {
                                "format": "short",
                                "label": null,
                                "logBase": 1,
                                "max": null,
                                "min": null,
                                "show": true
                            }
                        ]
                    },
                    {
                        "aliasColors": {},
                        "bars": true,
                        "dashLength": 10,
                        "dashes": false,
                        "datasource": "mylogstash-yarn-apps",
                        "fill": 1,
                        "id": 6,
                        "interval": ">60s",
                        "legend": {
                            "avg": false,
                            "current": false,
                            "max": false,
                            "min": false,
                            "show": true,
                            "total": false,
                            "values": false
                        },
                        "lines": false,
                        "linewidth": 1,
                        "links": [],
                        "nullPointMode": "null",
                        "percentage": false,
                        "pointradius": 5,
                        "points": false,
                        "renderer": "flot",
                        "seriesOverrides": [],
                        "spaceLength": 10,
                        "span": 4,
                        "stack": false,
                        "steppedLine": false,
                        "targets": [
                            {
                                "bucketAggs": [
                                    {
                                        "fake": true,
                                        "field": "appId",
                                        "id": "3",
                                        "settings": {
                                            "min_doc_count": 1,
                                            "order": "desc",
                                            "orderBy": "1",
                                            "size": "10"
                                        },
                                        "type": "terms"
                                    },
                                    {
                                        "field": "finishedTime",
                                        "id": "2",
                                        "settings": {
                                            "interval": "auto",
                                            "min_doc_count": 0,
                                            "trimEdges": 0
                                        },
                                        "type": "date_histogram"
                                    }
                                ],
                                "dsType": "elasticsearch",
                                "metrics": [
                                    {
                                        "field": "elapsedTime",
                                        "id": "1",
                                        "meta": {},
                                        "settings": {},
                                        "type": "max"
                                    }
                                ],
                                "query": "appState: FINISHED AND appType: MAPREDUCE AND queue: $queue",
                                "refId": "A",
                                "timeField": "finishedTime"
                            }
                        ],
                        "thresholds": [],
                        "timeFrom": null,
                        "timeShift": null,
                        "title": "Top-10已完成Mapreduce作业的时间消耗情况",
                        "tooltip": {
                            "shared": false,
                            "sort": 0,
                            "value_type": "individual"
                        },
                        "type": "graph",
                        "xaxis": {
                            "buckets": null,
                            "mode": "series",
                            "name": null,
                            "show": false,
                            "values": [
                                "max"
                            ]
                        },
                        "yaxes": [
                            {
                                "format": "short",
                                "label": null,
                                "logBase": 1,
                                "max": null,
                                "min": null,
                                "show": true
                            },
                            {
                                "format": "short",
                                "label": null,
                                "logBase": 1,
                                "max": null,
                                "min": null,
                                "show": true
                            }
                        ]
                    }
                ],
                "repeat": null,
                "repeatIteration": null,
                "repeatRowId": null,
                "showTitle": true,
                "title": "'$1' 最近10个已完成的Mapreduce作业情况 ",
                "titleSize": "h6"
            },
            {
                "collapse": false,
                "height": 250,
                "panels": [
                    {
                        "aliasColors": {},
                        "bars": true,
                        "dashLength": 10,
                        "dashes": false,
                        "datasource": "mylogstash-yarn-apps",
                        "fill": 1,
                        "id": 11,
                        "interval": ">60s",
                        "legend": {
                            "alignAsTable": false,
                            "avg": false,
                            "current": false,
                            "max": false,
                            "min": false,
                            "rightSide": false,
                            "show": true,
                            "total": false,
                            "values": false
                        },
                        "lines": false,
                        "linewidth": 1,
                        "links": [],
                        "nullPointMode": "null",
                        "percentage": false,
                        "pointradius": 5,
                        "points": false,
                        "renderer": "flot",
                        "seriesOverrides": [],
                        "spaceLength": 10,
                        "span": 4,
                        "stack": false,
                        "steppedLine": false,
                        "targets": [
                            {
                                "bucketAggs": [
                                    {
                                        "fake": true,
                                        "field": "appId",
                                        "id": "3",
                                        "settings": {
                                            "min_doc_count": 1,
                                            "order": "desc",
                                            "orderBy": "1",
                                            "size": "10"
                                        },
                                        "type": "terms"
                                    },
                                    {
                                        "field": "finishedTime",
                                        "id": "2",
                                        "settings": {
                                            "interval": "auto",
                                            "min_doc_count": 0,
                                            "trimEdges": 0
                                        },
                                        "type": "date_histogram"
                                    }
                                ],
                                "dsType": "elasticsearch",
                                "metrics": [
                                    {
                                        "field": "vcoreSeconds",
                                        "id": "1",
                                        "meta": {},
                                        "settings": {},
                                        "type": "max"
                                    }
                                ],
                                "query": "appType:SPARK AND appState:FINISHED AND queue: $queue",
                                "refId": "A",
                                "timeField": "finishedTime"
                            }
                        ],
                        "thresholds": [],
                        "timeFrom": null,
                        "timeShift": null,
                        "title": "Top-10已完成Spark作业的CPU消耗情况 ",
                        "tooltip": {
                            "shared": false,
                            "sort": 0,
                            "value_type": "individual"
                        },
                        "type": "graph",
                        "xaxis": {
                            "buckets": null,
                            "mode": "series",
                            "name": null,
                            "show": false,
                            "values": [
                                "total"
                            ]
                        },
                        "yaxes": [
                            {
                                "format": "short",
                                "label": null,
                                "logBase": 1,
                                "max": null,
                                "min": null,
                                "show": true
                            },
                            {
                                "format": "short",
                                "label": null,
                                "logBase": 1,
                                "max": null,
                                "min": null,
                                "show": true
                            }
                        ]
                    },
                    {
                        "aliasColors": {},
                        "bars": true,
                        "dashLength": 10,
                        "dashes": false,
                        "datasource": "mylogstash-yarn-apps",
                        "fill": 1,
                        "id": 12,
                        "interval": ">60s",
                        "legend": {
                            "alignAsTable": false,
                            "avg": false,
                            "current": false,
                            "max": false,
                            "min": false,
                            "rightSide": false,
                            "show": true,
                            "total": false,
                            "values": false
                        },
                        "lines": false,
                        "linewidth": 1,
                        "links": [],
                        "nullPointMode": "null",
                        "percentage": false,
                        "pointradius": 5,
                        "points": false,
                        "renderer": "flot",
                        "seriesOverrides": [],
                        "spaceLength": 10,
                        "span": 4,
                        "stack": false,
                        "steppedLine": false,
                        "targets": [
                            {
                                "bucketAggs": [
                                    {
                                        "fake": true,
                                        "field": "appId",
                                        "id": "3",
                                        "settings": {
                                            "min_doc_count": 1,
                                            "order": "desc",
                                            "orderBy": "1",
                                            "size": "10"
                                        },
                                        "type": "terms"
                                    },
                                    {
                                        "field": "finishedTime",
                                        "id": "2",
                                        "settings": {
                                            "interval": "auto",
                                            "min_doc_count": 0,
                                            "trimEdges": 0
                                        },
                                        "type": "date_histogram"
                                    }
                                ],
                                "dsType": "elasticsearch",
                                "metrics": [
                                    {
                                        "field": "memorySeconds",
                                        "id": "1",
                                        "meta": {},
                                        "settings": {},
                                        "type": "max"
                                    }
                                ],
                                "query": "appType:SPARK AND appState:FINISHED AND queue: $queue",
                                "refId": "A",
                                "timeField": "finishedTime"
                            }
                        ],
                        "thresholds": [],
                        "timeFrom": null,
                        "timeShift": null,
                        "title": "Top-10已完成Spark作业的内存消耗情况 ",
                        "tooltip": {
                            "shared": false,
                            "sort": 0,
                            "value_type": "individual"
                        },
                        "type": "graph",
                        "xaxis": {
                            "buckets": null,
                            "mode": "series",
                            "name": null,
                            "show": false,
                            "values": [
                                "total"
                            ]
                        },
                        "yaxes": [
                            {
                                "format": "short",
                                "label": null,
                                "logBase": 1,
                                "max": null,
                                "min": null,
                                "show": true
                            },
                            {
                                "format": "short",
                                "label": null,
                                "logBase": 1,
                                "max": null,
                                "min": null,
                                "show": true
                            }
                        ]
                    },
                    {
                        "aliasColors": {},
                        "bars": true,
                        "dashLength": 10,
                        "dashes": false,
                        "datasource": "mylogstash-yarn-apps",
                        "fill": 1,
                        "id": 13,
                        "interval": ">60s",
                        "legend": {
                            "alignAsTable": false,
                            "avg": false,
                            "current": false,
                            "max": false,
                            "min": false,
                            "rightSide": false,
                            "show": true,
                            "total": false,
                            "values": false
                        },
                        "lines": false,
                        "linewidth": 1,
                        "links": [],
                        "nullPointMode": "null",
                        "percentage": false,
                        "pointradius": 5,
                        "points": false,
                        "renderer": "flot",
                        "seriesOverrides": [],
                        "spaceLength": 10,
                        "span": 4,
                        "stack": false,
                        "steppedLine": false,
                        "targets": [
                            {
                                "bucketAggs": [
                                    {
                                        "fake": true,
                                        "field": "appId",
                                        "id": "3",
                                        "settings": {
                                            "min_doc_count": 1,
                                            "order": "desc",
                                            "orderBy": "1",
                                            "size": "10"
                                        },
                                        "type": "terms"
                                    },
                                    {
                                        "field": "finishedTime",
                                        "id": "2",
                                        "settings": {
                                            "interval": "auto",
                                            "min_doc_count": 0,
                                            "trimEdges": 0
                                        },
                                        "type": "date_histogram"
                                    }
                                ],
                                "dsType": "elasticsearch",
                                "metrics": [
                                    {
                                        "field": "elapsedTime",
                                        "id": "1",
                                        "meta": {},
                                        "settings": {},
                                        "type": "max"
                                    }
                                ],
                                "query": "appType:SPARK AND appState:FINISHED AND (NOT (appName:org.apache.spark.sql.hive.thriftserver.HiveThriftServer2)) AND queue: $queue",
                                "refId": "A",
                                "timeField": "finishedTime"
                            }
                        ],
                        "thresholds": [],
                        "timeFrom": null,
                        "timeShift": null,
                        "title": "Top-10已完成Spark作业的时间消耗情况 ",
                        "tooltip": {
                            "shared": false,
                            "sort": 0,
                            "value_type": "individual"
                        },
                        "type": "graph",
                        "xaxis": {
                            "buckets": null,
                            "mode": "series",
                            "name": null,
                            "show": false,
                            "values": [
                                "total"
                            ]
                        },
                        "yaxes": [
                            {
                                "format": "short",
                                "label": null,
                                "logBase": 1,
                                "max": null,
                                "min": null,
                                "show": true
                            },
                            {
                                "format": "short",
                                "label": null,
                                "logBase": 1,
                                "max": null,
                                "min": null,
                                "show": true
                            }
                        ]
                    }
                ],
                "repeat": null,
                "repeatIteration": null,
                "repeatRowId": null,
                "showTitle": true,
                "title": "'$1' 最近10个已完成的Spark作业情况 ",
                "titleSize": "h6"
            },
            {
                "collapse": false,
                "height": 250,
                "panels": [
                    {
                        "aliasColors": {},
                        "cacheTimeout": null,
                        "combine": {
                            "label": "Others",
                            "threshold": ""
                        },
                        "datasource": "mylogstash-yarn-apps",
                        "fontSize": "80%",
                        "format": "short",
                        "hideTimeOverride": false,
                        "id": 3,
                        "interval": ">60s",
                        "legend": {
                            "percentage": true,
                            "show": true,
                            "values": true
                        },
                        "legendType": "Under graph",
                        "links": [],
                        "maxDataPoints": 3,
                        "minSpan": null,
                        "nullPointMode": "connected",
                        "pieType": "pie",
                        "repeat": null,
                        "span": 6,
                        "strokeWidth": "1",
                        "targets": [
                            {
                                "alias": "",
                                "bucketAggs": [
                                    {
                                        "fake": true,
                                        "id": "4",
                                        "query": "*",
                                        "settings": {
                                            "filters": [
                                                {
                                                    "query": "elapsedTime: [0 TO 29]"
                                                },
                                                {
                                                    "query": "elapsedTime: [30 TO 60]"
                                                },
                                                {
                                                    "query": "elapsedTime: [61 TO 300]"
                                                },
                                                {
                                                    "query": "elapsedTime: [301 TO 900]"
                                                },
                                                {
                                                    "query": "elapsedTime: [901 TO 1800]"
                                                },
                                                {
                                                    "query": "elapsedTime: [1801 TO 3600]"
                                                },
                                                {
                                                    "query": "elapsedTime: [3601 TO 10800]"
                                                },
                                                {
                                                    "query": "elapsedTime: [10801 TO 2592000]"
                                                }
                                            ]
                                        },
                                        "type": "filters"
                                    },
                                    {
                                        "fake": true,
                                        "field": "finishedTime",
                                        "id": "3",
                                        "settings": {
                                            "interval": "auto",
                                            "min_doc_count": 0,
                                            "trimEdges": 0
                                        },
                                        "type": "date_histogram"
                                    }
                                ],
                                "dsType": "elasticsearch",
                                "metrics": [
                                    {
                                        "field": "select field",
                                        "id": "1",
                                        "meta": {},
                                        "settings": {},
                                        "type": "count"
                                    }
                                ],
                                "query": "appState: FINISHED AND appType: MAPREDUCE AND queue: $queue",
                                "refId": "A",
                                "timeField": "finishedTime"
                            }
                        ],
                        "title": "Mapreduce作业运行时间的分布情况 ",
                        "transparent": false,
                        "type": "grafana-piechart-panel",
                        "valueName": "total"
                    },
                    {
                        "aliasColors": {},
                        "cacheTimeout": null,
                        "combine": {
                            "label": "Others",
                            "threshold": ""
                        },
                        "datasource": "mylogstash-yarn-apps",
                        "fontSize": "80%",
                        "format": "short",
                        "hideTimeOverride": false,
                        "id": 14,
                        "interval": ">60s",
                        "legend": {
                            "percentage": true,
                            "show": true,
                            "values": true
                        },
                        "legendType": "Under graph",
                        "links": [],
                        "maxDataPoints": 3,
                        "minSpan": null,
                        "nullPointMode": "connected",
                        "pieType": "pie",
                        "span": 6,
                        "strokeWidth": "1",
                        "targets": [
                            {
                                "alias": "",
                                "bucketAggs": [
                                    {
                                        "fake": true,
                                        "id": "4",
                                        "query": "*",
                                        "settings": {
                                            "filters": [
                                                {
                                                    "query": "elapsedTime: [0 TO 29]"
                                                },
                                                {
                                                    "query": "elapsedTime: [30 TO 60]"
                                                },
                                                {
                                                    "query": "elapsedTime: [61 TO 300]"
                                                },
                                                {
                                                    "query": "elapsedTime: [301 TO 900]"
                                                },
                                                {
                                                    "query": "elapsedTime: [901 TO 1800]"
                                                },
                                                {
                                                    "query": "elapsedTime: [1801 TO 3600]"
                                                },
                                                {
                                                    "query": "elapsedTime: [3601 TO 10800]"
                                                },
                                                {
                                                    "query": "elapsedTime: [10801 TO 2592000]"
                                                }
                                            ]
                                        },
                                        "type": "filters"
                                    },
                                    {
                                        "fake": true,
                                        "field": "finishedTime",
                                        "id": "3",
                                        "settings": {
                                            "interval": "auto",
                                            "min_doc_count": 0,
                                            "trimEdges": 0
                                        },
                                        "type": "date_histogram"
                                    }
                                ],
                                "dsType": "elasticsearch",
                                "metrics": [
                                    {
                                        "field": "select field",
                                        "id": "1",
                                        "meta": {},
                                        "settings": {},
                                        "type": "count"
                                    }
                                ],
                                "query": "appState: FINISHED AND appType: SPARK AND queue: $queue",
                                "refId": "A",
                                "timeField": "finishedTime"
                            }
                        ],
                        "title": "Spark作业运行时间的分布情况",
                        "transparent": false,
                        "type": "grafana-piechart-panel",
                        "valueName": "total"
                    }
                ],
                "repeat": null,
                "repeatIteration": null,
                "repeatRowId": null,
                "showTitle": true,
                "title": "'$1' 已完成作业运行时间的分布情况",
                "titleSize": "h6"
            },
            {
                "collapse": false,
                "height": 250,
                "panels": [
                    {
                        "aliasColors": {},
                        "bars": true,
                        "dashLength": 10,
                        "dashes": false,
                        "datasource": "mylogstash-yarn-apps",
                        "fill": 1,
                        "id": 7,
                        "interval": ">60s",
                        "legend": {
                            "avg": false,
                            "current": false,
                            "max": false,
                            "min": false,
                            "show": true,
                            "total": false,
                            "values": false
                        },
                        "lines": false,
                        "linewidth": 1,
                        "links": [],
                        "nullPointMode": "null",
                        "percentage": false,
                        "pointradius": 5,
                        "points": false,
                        "renderer": "flot",
                        "seriesOverrides": [],
                        "spaceLength": 10,
                        "span": 6,
                        "stack": false,
                        "steppedLine": false,
                        "targets": [
                            {
                                "bucketAggs": [
                                    {
                                        "fake": true,
                                        "field": "appId",
                                        "id": "3",
                                        "settings": {
                                            "min_doc_count": 1,
                                            "order": "desc",
                                            "orderBy": "1",
                                            "size": "10"
                                        },
                                        "type": "terms"
                                    },
                                    {
                                        "field": "finishedTime",
                                        "id": "2",
                                        "settings": {
                                            "interval": "auto",
                                            "min_doc_count": 0,
                                            "trimEdges": 0
                                        },
                                        "type": "date_histogram"
                                    }
                                ],
                                "dsType": "elasticsearch",
                                "metrics": [
                                    {
                                        "field": "elapsedTime",
                                        "id": "1",
                                        "meta": {},
                                        "settings": {},
                                        "type": "max"
                                    }
                                ],
                                "query": "appType:MAPREDUCE  AND appState:RUNNING AND queue: $queue",
                                "refId": "A",
                                "timeField": "finishedTime"
                            }
                        ],
                        "thresholds": [],
                        "timeFrom": null,
                        "timeShift": null,
                        "title": "Top-10正在运行的Mapreduce作业时间消耗情况",
                        "tooltip": {
                            "shared": false,
                            "sort": 0,
                            "value_type": "individual"
                        },
                        "type": "graph",
                        "xaxis": {
                            "buckets": null,
                            "mode": "series",
                            "name": null,
                            "show": false,
                            "values": [
                                "max"
                            ]
                        },
                        "yaxes": [
                            {
                                "format": "short",
                                "label": null,
                                "logBase": 1,
                                "max": null,
                                "min": null,
                                "show": true
                            },
                            {
                                "format": "short",
                                "label": null,
                                "logBase": 1,
                                "max": null,
                                "min": null,
                                "show": true
                            }
                        ]
                    },
                    {
                        "aliasColors": {},
                        "bars": true,
                        "dashLength": 10,
                        "dashes": false,
                        "datasource": "mylogstash-yarn-apps",
                        "fill": 1,
                        "id": 15,
                        "interval": ">60s",
                        "legend": {
                            "avg": false,
                            "current": false,
                            "max": false,
                            "min": false,
                            "show": true,
                            "total": false,
                            "values": false
                        },
                        "lines": false,
                        "linewidth": 1,
                        "links": [],
                        "nullPointMode": "null",
                        "percentage": false,
                        "pointradius": 5,
                        "points": false,
                        "renderer": "flot",
                        "seriesOverrides": [],
                        "spaceLength": 10,
                        "span": 6,
                        "stack": false,
                        "steppedLine": false,
                        "targets": [
                            {
                                "bucketAggs": [
                                    {
                                        "fake": true,
                                        "field": "appId",
                                        "id": "3",
                                        "settings": {
                                            "min_doc_count": 1,
                                            "order": "desc",
                                            "orderBy": "1",
                                            "size": "10"
                                        },
                                        "type": "terms"
                                    },
                                    {
                                        "field": "finishedTime",
                                        "id": "2",
                                        "settings": {
                                            "interval": "auto",
                                            "min_doc_count": 0,
                                            "trimEdges": 0
                                        },
                                        "type": "date_histogram"
                                    }
                                ],
                                "dsType": "elasticsearch",
                                "metrics": [
                                    {
                                        "field": "elapsedTime",
                                        "id": "1",
                                        "meta": {},
                                        "settings": {},
                                        "type": "max"
                                    }
                                ],
                                "query": "appType:SPARK AND appState:RUNNING AND (NOT (appName:org.apache.spark.sql.hive.thriftserver.HiveThriftServer2)) AND queue: $queue",
                                "refId": "A",
                                "timeField": "finishedTime"
                            }
                        ],
                        "thresholds": [],
                        "timeFrom": null,
                        "timeShift": null,
                        "title": "Top-10正在运行的Spark作业时间消耗情况",
                        "tooltip": {
                            "shared": false,
                            "sort": 0,
                            "value_type": "individual"
                        },
                        "type": "graph",
                        "xaxis": {
                            "buckets": null,
                            "mode": "series",
                            "name": null,
                            "show": false,
                            "values": [
                                "max"
                            ]
                        },
                        "yaxes": [
                            {
                                "format": "short",
                                "label": null,
                                "logBase": 1,
                                "max": null,
                                "min": null,
                                "show": true
                            },
                            {
                                "format": "short",
                                "label": null,
                                "logBase": 1,
                                "max": null,
                                "min": null,
                                "show": true
                            }
                        ]
                    }
                ],
                "repeat": null,
                "repeatIteration": null,
                "repeatRowId": null,
                "showTitle": true,
                "title": "'$1' 正在运行的作业情况",
                "titleSize": "h6"
            },
            {
                "collapse": false,
                "height": 250,
                "panels": [
                    {
                        "aliasColors": {},
                        "bars": true,
                        "dashLength": 10,
                        "dashes": false,
                        "datasource": "mylogstash-yarn-apps",
                        "fill": 1,
                        "id": 8,
                        "interval": ">60s",
                        "legend": {
                            "avg": false,
                            "current": false,
                            "max": false,
                            "min": false,
                            "show": true,
                            "total": false,
                            "values": false
                        },
                        "lines": false,
                        "linewidth": 1,
                        "links": [],
                        "nullPointMode": "null",
                        "percentage": false,
                        "pointradius": 5,
                        "points": false,
                        "renderer": "flot",
                        "seriesOverrides": [],
                        "spaceLength": 10,
                        "span": 12,
                        "stack": false,
                        "steppedLine": false,
                        "targets": [
                            {
                                "bucketAggs": [
                                    {
                                        "fake": true,
                                        "field": "finalStatus",
                                        "id": "3",
                                        "settings": {
                                            "min_doc_count": 1,
                                            "order": "desc",
                                            "orderBy": "_count",
                                            "size": "10"
                                        },
                                        "type": "terms"
                                    },
                                    {
                                        "field": "finishedTime",
                                        "id": "2",
                                        "settings": {
                                            "interval": "auto",
                                            "min_doc_count": 0,
                                            "trimEdges": 0
                                        },
                                        "type": "date_histogram"
                                    }
                                ],
                                "dsType": "elasticsearch",
                                "metrics": [
                                    {
                                        "field": "select field",
                                        "id": "1",
                                        "type": "count"
                                    }
                                ],
                                "query": "queue: $queue AND (appState: FINISHED OR FAILED OR KILLED)",
                                "refId": "A",
                                "timeField": "finishedTime"
                            }
                        ],
                        "thresholds": [],
                        "timeFrom": null,
                        "timeShift": null,
                        "title": "作业统计量",
                        "tooltip": {
                            "shared": false,
                            "sort": 0,
                            "value_type": "individual"
                        },
                        "type": "graph",
                        "xaxis": {
                            "buckets": null,
                            "mode": "series",
                            "name": null,
                            "show": false,
                            "values": [
                                "total"
                            ]
                        },
                        "yaxes": [
                            {
                                "format": "short",
                                "label": null,
                                "logBase": 1,
                                "max": null,
                                "min": null,
                                "show": true
                            },
                            {
                                "format": "short",
                                "label": null,
                                "logBase": 1,
                                "max": null,
                                "min": null,
                                "show": true
                            }
                        ]
                    }
                ],
                "repeat": null,
                "repeatIteration": null,
                "repeatRowId": null,
                "showTitle": true,
                "title": "'$1' 作业统计量",
                "titleSize": "h6"
            }
        ],
        "schemaVersion": 14,
        "style": "dark",
        "tags": [],
        "templating": {
            "list": [
                {
                    "allValue": null,
                    "current": {
                        "text": "'$1'",
                        "value": "'$1'"
                    },
                    "datasource": "mylogstash-yarn-running",
                    "hide": 2,
                    "includeAll": false,
                    "label": "Yarn Queue",
                    "multi": false,
                    "name": "queue",
                    "options": [],
                    "query": "{\"find\": \"terms\", \"field\": \"queue\"}",
                    "refresh": 1,
                    "regex": ".*\\..*",
                    "sort": 0,
                    "tagValuesQuery": "",
                    "tags": [],
                    "tagsQuery": "",
                    "type": "query",
                    "useTags": false
                }
            ]
        },
        "time": {
            "from": "now-6h",
            "to": "now"
        },
        "timepicker": {
            "refresh_intervals": [
                "5s",
                "10s",
                "30s",
                "1m",
                "5m",
                "15m",
                "30m",
                "1h",
                "2h",
                "1d"
            ],
            "time_options": [
                "5m",
                "15m",
                "1h",
                "6h",
                "12h",
                "24h",
                "2d",
                "7d",
                "30d"
            ]
        },
        "timezone": "browser",
        "title": "租户资源使用报表",
        "version": 1
    },
    "overwrite": false
}' http://admin:admin@{{grafana_host}}:{{grafana_port}}/api/dashboards/db

curl -H 'Accept: application/json' -H 'Content-Type: application/json' -X POST --data '{
    "name": "'$1'",
    "login": "'$1'",
    "password": "'$1'"
}'  http://admin:admin@{{grafana_host}}:{{grafana_port}}/api/admin/users

curl -H 'Accept: application/json' -H 'Content-Type: application/json' -X POST --data '{
    "role": "Viewer",
    "loginOrEmail": "'$1'"
}' http://admin:admin@{{grafana_host}}:{{grafana_port}}/api/org/users

tenant=$1
userid=$(curl -H 'Accept: application/json' -H 'Content-Type: application/json' -X GET http://admin:admin@{{grafana_host}}:{{grafana_port}}/api/orgs/$orgid/users |xargs -d '{' -n 1 echo |awk -F '[:,]' -v tenant=$tenant '{if($8~tenant){print $4}}')

curl -H 'Accept: application/json' -H 'Content-Type: application/json' -X DELETE http://admin:admin@{{grafana_host}}:{{grafana_port}}/api/orgs/1/users/$userid

curl -H 'Accept: application/json' -H 'Content-Type: application/json' -X POST http://admin:admin@{{grafana_host}}:{{grafana_port}}/api/users/$userid/using/$orgid

curl -H 'Accept: application/json' -H 'Content-Type: application/json' -X POST http://admin:admin@{{grafana_host}}:{{grafana_port}}/api/users/1/using/1
